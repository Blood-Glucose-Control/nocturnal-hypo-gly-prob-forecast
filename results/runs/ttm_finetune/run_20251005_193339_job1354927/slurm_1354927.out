Using configuration file: models/configs/kaggle_batch_size_experiment/ttm_batch_size_2048_experiment.yaml

=== Environment Check ===
Job started at: 2025-10-05 19:33:44 UTC
Job ID: 1354927
Node: watgpu608
Run Directory: /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927
Virtual Environment source python path: /u6/cjrisi/nocturnal/.noctprob-venv/bin/python
Python Version: Python 3.11.4
Python internal path check: /u6/cjrisi/nocturnal/.noctprob-venv/bin/python

=== GPU Information ===
Sun Oct  5 19:33:44 2025
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 575.57.08              Driver Version: 575.57.08      CUDA Version: 12.9     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA L40S                    On  |   00000000:04:00.0 Off |                    0 |
| N/A   32C    P8             32W /  350W |       0MiB /  46068MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
GPU Driver Version: 575.57.08
GPU Name: NVIDIA L40S
GPU Memory: 46068 MiB
=====================================

=== Model Registry Initialization ===
Registering run in model registry...
Registered run: run_20251005_193339_job1354927

=== GPU Monitoring Log Setup ===
Starting GPU monitoring...
Started GPU monitoring (PID: 68721) and utilization logging (PID: 68722)

=== Starting Training ===
Training started at: 2025-10-05 19:33:45 UTC
Running command:
  python /u6/cjrisi/nocturnal/src/train/ttm_runner.py \
    --run-dir "/u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927"
    --config "/u6/cjrisi/nocturnal/models/configs/kaggle_batch_size_experiment/ttm_batch_size_2048_experiment.yaml"

INFO: [main] =====================================
INFO: [main] === TTM Runner Starting ===
INFO: [main] Loading configuration from: /u6/cjrisi/nocturnal/models/configs/kaggle_batch_size_experiment/ttm_batch_size_2048_experiment.yaml
INFO: [main] Configuration saved to: /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927/experiment_config.yaml
INFO: [main] =====================================
INFO: [main] === Calling finetune_ttm() ===
INFO: [enhanced_info_print] [main] -------------------- Preparing data... --------------------

INFO: [enhanced_info_print] [main] Found 9 processed CSV files in /u6/cjrisi/nocturnal/cache/data/kaggle_brisT1D/processed
INFO: [enhanced_info_print] [main] Loaded p10_full: 25803 rows
INFO: [enhanced_info_print] [main] Loaded p11_full: 25559 rows
INFO: [enhanced_info_print] [main] Loaded p01_full: 8711 rows
INFO: [enhanced_info_print] [main] Loaded p06_full: 8791 rows
INFO: [enhanced_info_print] [main] Loaded p05_full: 8808 rows
INFO: [enhanced_info_print] [main] Loaded p12_full: 26371 rows
INFO: [enhanced_info_print] [main] Loaded p02_full: 26423 rows
INFO: [enhanced_info_print] [main] Loaded p04_full: 24983 rows
INFO: [enhanced_info_print] [main] Loaded p03_full: 26423 rows
INFO: [enhanced_info_print] [main] Successfully loaded 9 patients
INFO: [enhanced_info_print] [main] Processing patient p10_full...
INFO: [enhanced_info_print] [main] Processing patient p11_full...
INFO: [enhanced_info_print] [main] Processing patient p12_full...
INFO: [enhanced_info_print] [main] Processing patient p02_full...
INFO: [enhanced_info_print] [main] Processing patient p04_full...
INFO: [enhanced_info_print] [main] Processing patient p03_full...
INFO: [enhanced_info_print] [main] Data length: 155562
INFO: [enhanced_info_print] [main] Split config: Train 90.0%, Test 10.0%
INFO: [enhanced_info_print] [main] Data ids: ['p10_full' 'p11_full' 'p12_full' 'p02_full' 'p04_full' 'p03_full']
INFO: [enhanced_info_print] [main] Data processing complete
INFO: [enhanced_info_print] [main] -------------------- Preparing model... --------------------

INFO: [enhanced_info_print] [main] Model path: ibm-granite/granite-timeseries-ttm-r2
INFO: [enhanced_info_print] [main] -------------------- Running few-shot 100% --------------------

2025-10-05T19:33:54 - Loading model from: ibm-granite/granite-timeseries-ttm-r2
2025-10-05T19:33:55 - Model loaded successfully from ibm-granite/granite-timeseries-ttm-r2, revision = main.
2025-10-05T19:33:55 - [TTM] context_length = 512, prediction_length = 96
INFO: [enhanced_info_print] [main] Using learning rate = 0.002
INFO: [enhanced_info_print] [main] Training for 10 epochs
Using auto half precision backend
INFO: [enhanced_info_print] [main] -------------------- Fine-tuning... --------------------

INFO: [enhanced_info_print] [main] Starting new training run in output directory: /u6/cjrisi/nocturnal/models/ttm/kaggle_brisT1D/2025-10-05_19-33-54
***** Running training *****
  Num examples = 136,360
  Num Epochs = 10
  Instantaneous batch size per device = 2,048
  Total train batch size (w. parallel, distributed & accumulation) = 2,048
  Gradient Accumulation steps = 1
  Total optimization steps = 670
  Number of trainable parameters = 289,696
Number of params before freezing backbone 805280
Number of params after freezing the backbone 289696
  0%|          | 0/670 [00:00<?, ?it/s]  0%|          | 1/670 [00:16<3:04:06, 16.51s/it]                                                   0%|          | 1/670 [00:16<3:04:06, 16.51s/it]  0%|          | 3/670 [00:16<48:00,  4.32s/it]    1%|          | 5/670 [00:16<23:32,  2.12s/it]  1%|          | 7/670 [00:17<14:18,  1.29s/it]  1%|▏         | 9/670 [00:17<09:08,  1.20it/s]  2%|▏         | 11/670 [00:17<06:10,  1.78it/s]  2%|▏         | 13/670 [00:17<04:21,  2.51it/s]  2%|▏         | 15/670 [00:17<03:10,  3.43it/s]  3%|▎         | 17/670 [00:17<02:24,  4.53it/s]  3%|▎         | 19/670 [00:17<01:52,  5.78it/s]  3%|▎         | 21/670 [00:17<01:31,  7.11it/s]  3%|▎         | 23/670 [00:18<01:16,  8.46it/s]  4%|▎         | 25/670 [00:18<01:06,  9.73it/s]  4%|▍         | 27/670 [00:18<01:00, 10.58it/s]  4%|▍         | 29/670 [00:18<00:55, 11.60it/s]  5%|▍         | 31/670 [00:18<00:54, 11.79it/s]  5%|▍         | 33/670 [00:18<00:47, 13.32it/s]  5%|▌         | 35/670 [00:18<00:46, 13.74it/s]  6%|▌         | 37/670 [00:19<00:44, 14.10it/s]  6%|▌         | 39/670 [00:19<01:10,  9.00it/s]  6%|▌         | 41/670 [00:19<01:00, 10.32it/s]  6%|▋         | 43/670 [00:19<00:53, 11.77it/s]  7%|▋         | 45/670 [00:19<00:49, 12.57it/s]  7%|▋         | 47/670 [00:19<00:47, 13.09it/s]  7%|▋         | 49/670 [00:20<00:45, 13.50it/s]  8%|▊         | 51/670 [00:20<00:44, 13.83it/s]  8%|▊         | 53/670 [00:20<00:43, 14.03it/s]  8%|▊         | 55/670 [00:20<00:45, 13.55it/s]  9%|▊         | 57/670 [00:20<00:43, 14.09it/s]  9%|▉         | 59/670 [00:20<00:42, 14.36it/s]  9%|▉         | 61/670 [00:20<00:41, 14.64it/s]  9%|▉         | 63/670 [00:21<00:42, 14.41it/s] 10%|▉         | 65/670 [00:21<00:40, 14.83it/s] 10%|█         | 67/670 [00:22<02:18,  4.37it/s]{'loss': 0.9891, 'grad_norm': 0.6484450697898865, 'learning_rate': 0.002, 'epoch': 0.01, 'timestamp': 1759692852.4600136, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
 10%|█         | 69/670 [00:38<26:29,  2.64s/it] 11%|█         | 71/670 [00:39<18:40,  1.87s/it] 11%|█         | 73/670 [00:39<13:35,  1.37s/it] 11%|█         | 75/670 [00:39<09:39,  1.03it/s] 11%|█▏        | 77/670 [00:39<06:56,  1.43it/s] 12%|█▏        | 79/670 [00:39<05:01,  1.96it/s] 12%|█▏        | 81/670 [00:39<03:39,  2.68it/s] 12%|█▏        | 83/670 [00:40<02:45,  3.54it/s] 13%|█▎        | 85/670 [00:40<02:07,  4.60it/s] 13%|█▎        | 87/670 [00:40<01:38,  5.92it/s] 13%|█▎        | 89/670 [00:40<01:21,  7.11it/s] 14%|█▎        | 91/670 [00:40<01:08,  8.41it/s] 14%|█▍        | 93/670 [00:40<00:59,  9.69it/s] 14%|█▍        | 95/670 [00:40<00:52, 10.86it/s] 14%|█▍        | 97/670 [00:41<00:48, 11.76it/s] 15%|█▍        | 99/670 [00:41<00:45, 12.48it/s]                                                 15%|█▍        | 100/670 [00:41<00:45, 12.48it/s] 15%|█▌        | 101/670 [00:41<00:43, 13.03it/s] 15%|█▌        | 103/670 [00:41<00:42, 13.42it/s] 16%|█▌        | 105/670 [00:41<00:41, 13.72it/s] 16%|█▌        | 107/670 [00:42<01:01,  9.16it/s] 16%|█▋        | 109/670 [00:42<00:53, 10.58it/s] 17%|█▋        | 111/670 [00:42<00:48, 11.51it/s] 17%|█▋        | 113/670 [00:42<00:46, 11.99it/s] 17%|█▋        | 115/670 [00:42<00:46, 12.06it/s] 17%|█▋        | 117/670 [00:42<00:43, 12.79it/s] 18%|█▊        | 119/670 [00:42<00:41, 13.20it/s] 18%|█▊        | 121/670 [00:42<00:39, 13.90it/s] 18%|█▊        | 123/670 [00:43<00:39, 13.90it/s] 19%|█▊        | 125/670 [00:43<00:39, 13.63it/s] 19%|█▉        | 127/670 [00:43<00:39, 13.89it/s] 19%|█▉        | 129/670 [00:43<00:38, 13.91it/s] 20%|█▉        | 131/670 [00:43<00:37, 14.30it/s] 20%|█▉        | 133/670 [00:43<00:36, 14.75it/s]{'loss': 0.8435, 'grad_norm': 0.0800054594874382, 'learning_rate': 0.0019802967070534504, 'epoch': 1.49, 'timestamp': 1759692877.233097, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
 20%|██        | 134/670 [01:00<00:36, 14.75it/s] 20%|██        | 135/670 [01:00<23:14,  2.61s/it] 20%|██        | 136/670 [01:01<19:21,  2.18s/it] 21%|██        | 138/670 [01:01<12:59,  1.46s/it] 21%|██        | 140/670 [01:01<08:56,  1.01s/it] 21%|██        | 142/670 [01:01<06:36,  1.33it/s] 21%|██▏       | 144/670 [01:01<04:42,  1.86it/s] 22%|██▏       | 146/670 [01:01<03:27,  2.53it/s] 22%|██▏       | 148/670 [01:02<02:36,  3.34it/s] 22%|██▏       | 150/670 [01:02<01:59,  4.35it/s] 23%|██▎       | 152/670 [01:02<01:34,  5.46it/s] 23%|██▎       | 154/670 [01:02<01:17,  6.67it/s] 23%|██▎       | 156/670 [01:02<01:06,  7.77it/s] 24%|██▎       | 158/670 [01:02<00:56,  9.01it/s] 24%|██▍       | 160/670 [01:02<00:51,  9.93it/s] 24%|██▍       | 162/670 [01:03<00:46, 10.90it/s] 24%|██▍       | 164/670 [01:03<00:44, 11.49it/s] 25%|██▍       | 166/670 [01:03<00:41, 12.14it/s] 25%|██▌       | 168/670 [01:03<00:39, 12.65it/s] 25%|██▌       | 170/670 [01:03<00:39, 12.78it/s] 26%|██▌       | 172/670 [01:04<00:55,  8.92it/s] 26%|██▌       | 174/670 [01:04<00:50,  9.81it/s] 26%|██▋       | 176/670 [01:04<00:45, 10.86it/s] 27%|██▋       | 178/670 [01:04<00:42, 11.47it/s] 27%|██▋       | 180/670 [01:04<00:40, 12.22it/s] 27%|██▋       | 182/670 [01:04<00:35, 13.66it/s] 27%|██▋       | 184/670 [01:04<00:35, 13.74it/s] 28%|██▊       | 186/670 [01:05<00:36, 13.27it/s] 28%|██▊       | 188/670 [01:05<00:37, 13.02it/s] 28%|██▊       | 190/670 [01:05<00:36, 13.01it/s] 29%|██▊       | 192/670 [01:05<00:35, 13.39it/s] 29%|██▉       | 194/670 [01:05<00:36, 13.04it/s] 29%|██▉       | 196/670 [01:05<00:34, 13.61it/s] 30%|██▉       | 198/670 [01:05<00:32, 14.57it/s]                                                  30%|██▉       | 200/670 [01:06<00:32, 14.57it/s] 30%|███       | 201/670 [01:07<01:35,  4.92it/s]{'loss': 0.8281, 'grad_norm': 0.10665237903594971, 'learning_rate': 0.0019605914452309682, 'epoch': 2.99, 'timestamp': 1759692902.001486, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
 30%|███       | 201/670 [01:20<01:35,  4.92it/s] 30%|███       | 202/670 [01:22<20:27,  2.62s/it] 30%|███       | 203/670 [01:22<16:52,  2.17s/it] 31%|███       | 205/670 [01:23<11:13,  1.45s/it] 31%|███       | 207/670 [01:23<07:56,  1.03s/it] 31%|███       | 209/670 [01:23<05:34,  1.38it/s] 31%|███▏      | 211/670 [01:23<03:58,  1.93it/s] 32%|███▏      | 213/670 [01:23<02:52,  2.65it/s] 32%|███▏      | 215/670 [01:23<02:07,  3.56it/s] 32%|███▏      | 217/670 [01:24<01:37,  4.64it/s] 33%|███▎      | 219/670 [01:24<01:16,  5.87it/s] 33%|███▎      | 221/670 [01:24<01:02,  7.21it/s] 33%|███▎      | 223/670 [01:24<00:52,  8.57it/s] 34%|███▎      | 225/670 [01:24<00:44,  9.90it/s] 34%|███▍      | 227/670 [01:24<00:40, 11.03it/s] 34%|███▍      | 229/670 [01:24<00:37, 11.80it/s] 34%|███▍      | 231/670 [01:25<00:34, 12.65it/s] 35%|███▍      | 233/670 [01:25<00:32, 13.43it/s] 35%|███▌      | 235/670 [01:25<00:31, 13.90it/s] 35%|███▌      | 237/670 [01:25<00:30, 14.28it/s] 36%|███▌      | 239/670 [01:25<00:46,  9.18it/s] 36%|███▌      | 241/670 [01:25<00:40, 10.67it/s] 36%|███▋      | 243/670 [01:26<00:35, 11.90it/s] 37%|███▋      | 245/670 [01:26<00:33, 12.76it/s] 37%|███▋      | 247/670 [01:26<00:31, 13.42it/s] 37%|███▋      | 249/670 [01:26<00:30, 13.93it/s] 37%|███▋      | 251/670 [01:26<00:29, 14.32it/s] 38%|███▊      | 253/670 [01:26<00:28, 14.76it/s] 38%|███▊      | 255/670 [01:26<00:27, 14.86it/s] 38%|███▊      | 257/670 [01:26<00:27, 15.00it/s] 39%|███▊      | 259/670 [01:27<00:27, 15.10it/s] 39%|███▉      | 261/670 [01:27<00:26, 15.23it/s] 39%|███▉      | 263/670 [01:27<00:26, 15.18it/s] 40%|███▉      | 265/670 [01:27<00:26, 15.03it/s] 40%|████      | 268/670 [01:28<01:21,  4.92it/s] 40%|████      | 268/670 [01:40<01:21,  4.92it/s] 40%|████      | 269/670 [01:45<18:15,  2.73s/it] 40%|████      | 270/670 [01:45<15:01,  2.25s/it] 41%|████      | 272/670 [01:45<09:59,  1.51s/it] 41%|████      | 274/670 [01:45<07:01,  1.06s/it] 41%|████      | 276/670 [01:45<04:53,  1.34it/s] 41%|████▏     | 278/670 [01:45<03:29,  1.87it/s] 42%|████▏     | 280/670 [01:46<02:33,  2.54it/s] 42%|████▏     | 282/670 [01:46<01:53,  3.42it/s] 42%|████▏     | 284/670 [01:46<01:27,  4.41it/s] 43%|████▎     | 286/670 [01:46<01:07,  5.71it/s] 43%|████▎     | 288/670 [01:46<00:54,  7.02it/s] 43%|████▎     | 290/670 [01:46<00:45,  8.37it/s] 44%|████▎     | 292/670 [01:46<00:39,  9.54it/s] 44%|████▍     | 294/670 [01:47<00:33, 11.29it/s] 44%|████▍     | 296/670 [01:47<00:30, 12.12it/s] 44%|████▍     | 298/670 [01:47<00:28, 12.87it/s] 45%|████▍     | 300/670 [01:47<00:27, 13.50it/s]                                                  45%|████▍     | 300/670 [01:47<00:27, 13.50it/s] 45%|████▌     | 302/670 [01:47<00:26, 13.96it/s] 45%|████▌     | 304/670 [01:47<00:25, 14.48it/s] 46%|████▌     | 306/670 [01:47<00:25, 14.33it/s] 46%|████▌     | 308/670 [01:48<00:40,  8.98it/s] 46%|████▋     | 310/670 [01:48<00:34, 10.31it/s] 47%|████▋     | 312/670 [01:48<00:30, 11.55it/s] 47%|████▋     | 314/670 [01:48<00:28, 12.41it/s] 47%|████▋     | 316/670 [01:48<00:27, 13.08it/s] 47%|████▋     | 318/670 [01:48<00:25, 13.60it/s] 48%|████▊     | 320/670 [01:49<00:24, 14.28it/s] 48%|████▊     | 322/670 [01:49<00:24, 14.21it/s] 48%|████▊     | 324/670 [01:49<00:24, 14.41it/s] 49%|████▊     | 326/670 [01:49<00:23, 14.55it/s] 49%|████▉     | 328/670 [01:49<00:23, 14.66it/s] 49%|████▉     | 330/670 [01:49<00:23, 14.62it/s] 50%|████▉     | 332/670 [01:49<00:23, 14.34it/s] 50%|████▉     | 334/670 [01:49<00:21, 15.66it/s]{'loss': 0.8229, 'grad_norm': 0.12191407382488251, 'learning_rate': 0.0019410822637948818, 'epoch': 4.48, 'timestamp': 1759692943.3639817, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
 50%|█████     | 335/670 [02:00<00:21, 15.66it/s] 50%|█████     | 336/670 [02:06<14:13,  2.56s/it] 50%|█████     | 337/670 [02:06<11:49,  2.13s/it] 51%|█████     | 339/670 [02:06<07:57,  1.44s/it] 51%|█████     | 341/670 [02:07<05:39,  1.03s/it] 51%|█████     | 343/670 [02:07<03:58,  1.37it/s] 51%|█████▏    | 345/670 [02:07<02:50,  1.91it/s] 52%|█████▏    | 347/670 [02:07<02:04,  2.59it/s] 52%|█████▏    | 349/670 [02:07<01:32,  3.49it/s] 52%|█████▏    | 351/670 [02:08<01:11,  4.46it/s] 53%|█████▎    | 353/670 [02:08<00:55,  5.69it/s] 53%|█████▎    | 355/670 [02:08<00:43,  7.24it/s] 53%|█████▎    | 357/670 [02:08<00:36,  8.52it/s] 54%|█████▎    | 359/670 [02:08<00:31,  9.99it/s] 54%|█████▍    | 361/670 [02:08<00:28, 10.66it/s] 54%|█████▍    | 363/670 [02:08<00:27, 11.02it/s] 54%|█████▍    | 365/670 [02:09<00:25, 11.99it/s] 55%|█████▍    | 367/670 [02:09<00:23, 12.93it/s] 55%|█████▌    | 369/670 [02:09<00:22, 13.38it/s] 55%|█████▌    | 371/670 [02:09<00:21, 13.82it/s] 56%|█████▌    | 373/670 [02:09<00:21, 13.69it/s] 56%|█████▌    | 375/670 [02:09<00:32,  9.14it/s] 56%|█████▋    | 377/670 [02:10<00:27, 10.74it/s] 57%|█████▋    | 379/670 [02:10<00:24, 11.74it/s] 57%|█████▋    | 381/670 [02:10<00:22, 12.98it/s] 57%|█████▋    | 383/670 [02:10<00:21, 13.09it/s] 57%|█████▋    | 385/670 [02:10<00:20, 13.60it/s] 58%|█████▊    | 387/670 [02:10<00:20, 13.99it/s] 58%|█████▊    | 389/670 [02:10<00:19, 14.30it/s] 58%|█████▊    | 391/670 [02:10<00:18, 14.81it/s] 59%|█████▊    | 393/670 [02:11<00:19, 14.00it/s] 59%|█████▉    | 395/670 [02:11<00:19, 14.43it/s] 59%|█████▉    | 397/670 [02:11<00:19, 14.27it/s] 60%|█████▉    | 399/670 [02:11<00:17, 15.30it/s]                                                  60%|█████▉    | 400/670 [02:11<00:17, 15.30it/s] 60%|█████▉    | 401/670 [02:11<00:16, 16.45it/s]{'loss': 0.8192, 'grad_norm': 0.18553799390792847, 'learning_rate': 0.0019217672116156727, 'epoch': 5.97, 'timestamp': 1759692967.5091357, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
 60%|██████    | 403/670 [02:28<11:29,  2.58s/it] 60%|██████    | 404/670 [02:28<09:30,  2.15s/it] 61%|██████    | 406/670 [02:28<06:23,  1.45s/it] 61%|██████    | 408/670 [02:29<04:31,  1.04s/it] 61%|██████    | 410/670 [02:29<03:09,  1.37it/s] 61%|██████▏   | 412/670 [02:29<02:15,  1.91it/s] 62%|██████▏   | 414/670 [02:29<01:37,  2.62it/s] 62%|██████▏   | 416/670 [02:29<01:12,  3.50it/s] 62%|██████▏   | 418/670 [02:29<00:55,  4.58it/s] 63%|██████▎   | 420/670 [02:29<00:43,  5.81it/s] 63%|██████▎   | 422/670 [02:30<00:34,  7.22it/s] 63%|██████▎   | 424/670 [02:30<00:28,  8.50it/s] 64%|██████▎   | 426/670 [02:30<00:25,  9.60it/s] 64%|██████▍   | 428/670 [02:30<00:22, 10.79it/s] 64%|██████▍   | 430/670 [02:30<00:20, 11.82it/s] 64%|██████▍   | 432/670 [02:30<00:19, 12.50it/s] 65%|██████▍   | 434/670 [02:30<00:18, 13.02it/s] 65%|██████▌   | 436/670 [02:31<00:17, 13.41it/s] 65%|██████▌   | 438/670 [02:31<00:16, 13.69it/s] 66%|██████▌   | 440/670 [02:31<00:24,  9.56it/s] 66%|██████▌   | 442/670 [02:31<00:20, 10.96it/s] 66%|██████▋   | 444/670 [02:31<00:18, 12.08it/s] 67%|██████▋   | 446/670 [02:32<00:22,  9.91it/s] 67%|██████▋   | 448/670 [02:32<00:20, 10.66it/s] 67%|██████▋   | 450/670 [02:32<00:18, 11.63it/s] 67%|██████▋   | 452/670 [02:32<00:17, 12.32it/s] 68%|██████▊   | 454/670 [02:32<00:16, 12.89it/s] 68%|██████▊   | 456/670 [02:32<00:16, 13.31it/s] 68%|██████▊   | 458/670 [02:32<00:15, 13.57it/s] 69%|██████▊   | 460/670 [02:33<00:15, 13.85it/s] 69%|██████▉   | 462/670 [02:33<00:14, 14.06it/s] 69%|██████▉   | 464/670 [02:33<00:15, 13.71it/s] 70%|██████▉   | 466/670 [02:33<00:14, 14.03it/s] 70%|██████▉   | 468/670 [02:33<00:14, 14.38it/s] 70%|███████   | 469/670 [02:50<00:13, 14.38it/s] 70%|███████   | 470/670 [02:51<08:58,  2.69s/it] 70%|███████   | 471/670 [02:51<07:26,  2.24s/it] 71%|███████   | 473/670 [02:51<04:58,  1.52s/it] 71%|███████   | 475/670 [02:51<03:31,  1.08s/it] 71%|███████   | 477/670 [02:51<02:26,  1.31it/s] 71%|███████▏  | 479/670 [02:52<01:43,  1.85it/s] 72%|███████▏  | 481/670 [02:52<01:15,  2.50it/s] 72%|███████▏  | 483/670 [02:52<00:55,  3.34it/s] 72%|███████▏  | 485/670 [02:52<00:41,  4.45it/s] 73%|███████▎  | 487/670 [02:52<00:32,  5.58it/s] 73%|███████▎  | 489/670 [02:52<00:26,  6.88it/s] 73%|███████▎  | 491/670 [02:52<00:20,  8.53it/s] 74%|███████▎  | 493/670 [02:53<00:18,  9.77it/s] 74%|███████▍  | 495/670 [02:53<00:16, 10.56it/s] 74%|███████▍  | 497/670 [02:53<00:15, 10.82it/s] 74%|███████▍  | 499/670 [02:53<00:14, 11.86it/s]                                                  75%|███████▍  | 500/670 [02:53<00:14, 11.86it/s] 75%|███████▍  | 501/670 [02:53<00:12, 13.20it/s] 75%|███████▌  | 503/670 [02:53<00:12, 13.70it/s] 75%|███████▌  | 505/670 [02:53<00:12, 13.32it/s] 76%|███████▌  | 507/670 [02:54<00:11, 13.85it/s] 76%|███████▌  | 509/670 [02:54<00:17,  8.96it/s] 76%|███████▋  | 511/670 [02:54<00:15, 10.24it/s] 77%|███████▋  | 513/670 [02:54<00:13, 11.36it/s] 77%|███████▋  | 515/670 [02:54<00:12, 12.42it/s] 77%|███████▋  | 517/670 [02:54<00:11, 13.42it/s] 77%|███████▋  | 519/670 [02:55<00:11, 12.89it/s] 78%|███████▊  | 521/670 [02:55<00:11, 13.51it/s] 78%|███████▊  | 523/670 [02:55<00:09, 14.95it/s] 78%|███████▊  | 525/670 [02:55<00:09, 14.87it/s] 79%|███████▊  | 527/670 [02:55<00:09, 15.48it/s] 79%|███████▉  | 529/670 [02:55<00:09, 14.92it/s] 79%|███████▉  | 531/670 [02:55<00:09, 14.95it/s] 80%|███████▉  | 533/670 [02:56<00:08, 15.28it/s] 80%|████████  | 536/670 [02:57<00:27,  4.94it/s]{'loss': 0.8127, 'grad_norm': 0.11542090773582458, 'learning_rate': 0.001902644356978859, 'epoch': 7.46, 'timestamp': 1759693009.5016227, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
 80%|████████  | 536/670 [03:10<00:27,  4.94it/s] 80%|████████  | 537/670 [03:13<05:52,  2.65s/it] 80%|████████  | 538/670 [03:13<04:48,  2.19s/it] 81%|████████  | 540/670 [03:13<03:09,  1.46s/it] 81%|████████  | 542/670 [03:13<02:13,  1.04s/it] 81%|████████  | 544/670 [03:13<01:32,  1.37it/s] 81%|████████▏ | 546/670 [03:13<01:04,  1.92it/s] 82%|████████▏ | 548/670 [03:14<00:46,  2.63it/s] 82%|████████▏ | 550/670 [03:14<00:34,  3.53it/s] 82%|████████▏ | 552/670 [03:14<00:25,  4.60it/s] 83%|████████▎ | 554/670 [03:14<00:19,  5.84it/s] 83%|████████▎ | 556/670 [03:14<00:15,  7.18it/s] 83%|████████▎ | 558/670 [03:14<00:13,  8.54it/s] 84%|████████▎ | 560/670 [03:14<00:11,  9.76it/s] 84%|████████▍ | 562/670 [03:15<00:10, 10.55it/s] 84%|████████▍ | 564/670 [03:15<00:09, 11.44it/s] 84%|████████▍ | 566/670 [03:15<00:08, 12.41it/s] 85%|████████▍ | 568/670 [03:15<00:08, 12.64it/s] 85%|████████▌ | 570/670 [03:15<00:07, 12.94it/s] 85%|████████▌ | 572/670 [03:15<00:07, 13.05it/s] 86%|████████▌ | 574/670 [03:16<00:09,  9.82it/s] 86%|████████▌ | 576/670 [03:16<00:08, 11.02it/s] 86%|████████▋ | 578/670 [03:16<00:08, 10.59it/s] 87%|████████▋ | 580/670 [03:16<00:07, 11.59it/s] 87%|████████▋ | 582/670 [03:16<00:07, 12.13it/s] 87%|████████▋ | 584/670 [03:16<00:06, 12.58it/s] 87%|████████▋ | 586/670 [03:16<00:06, 12.77it/s] 88%|████████▊ | 588/670 [03:17<00:05, 14.26it/s] 88%|████████▊ | 590/670 [03:17<00:05, 14.82it/s] 88%|████████▊ | 592/670 [03:17<00:05, 14.13it/s] 89%|████████▊ | 594/670 [03:17<00:05, 13.35it/s] 89%|████████▉ | 596/670 [03:17<00:05, 13.82it/s] 89%|████████▉ | 598/670 [03:17<00:05, 14.20it/s] 90%|████████▉ | 600/670 [03:17<00:04, 14.42it/s]                                                  90%|████████▉ | 600/670 [03:17<00:04, 14.42it/s] 90%|████████▉ | 602/670 [03:18<00:04, 14.36it/s]{'loss': 0.815, 'grad_norm': 0.1527900993824005, 'learning_rate': 0.0018837117873917895, 'epoch': 8.96, 'timestamp': 1759693033.8815315, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
 90%|█████████ | 603/670 [03:30<00:04, 14.36it/s] 90%|█████████ | 604/670 [03:34<02:49,  2.56s/it] 90%|█████████ | 605/670 [03:34<02:18,  2.14s/it] 91%|█████████ | 607/670 [03:35<01:31,  1.44s/it] 91%|█████████ | 609/670 [03:35<01:00,  1.00it/s] 91%|█████████ | 611/670 [03:35<00:43,  1.35it/s] 91%|█████████▏| 613/670 [03:35<00:30,  1.89it/s] 92%|█████████▏| 615/670 [03:35<00:21,  2.57it/s] 92%|█████████▏| 617/670 [03:36<00:15,  3.41it/s] 92%|█████████▏| 619/670 [03:36<00:11,  4.45it/s] 93%|█████████▎| 621/670 [03:36<00:08,  5.55it/s] 93%|█████████▎| 623/670 [03:36<00:06,  6.80it/s] 93%|█████████▎| 625/670 [03:36<00:05,  8.05it/s] 94%|█████████▎| 627/670 [03:36<00:04,  9.18it/s] 94%|█████████▍| 629/670 [03:36<00:04,  9.99it/s] 94%|█████████▍| 631/670 [03:37<00:03, 11.35it/s] 94%|█████████▍| 633/670 [03:37<00:03, 11.93it/s] 95%|█████████▍| 635/670 [03:37<00:02, 12.25it/s] 95%|█████████▌| 637/670 [03:37<00:02, 13.01it/s] 95%|█████████▌| 639/670 [03:37<00:02, 13.45it/s] 96%|█████████▌| 641/670 [03:37<00:02, 13.70it/s] 96%|█████████▌| 643/670 [03:38<00:02,  9.04it/s] 96%|█████████▋| 645/670 [03:38<00:02, 10.43it/s] 97%|█████████▋| 647/670 [03:38<00:01, 11.87it/s] 97%|█████████▋| 649/670 [03:38<00:01, 12.31it/s] 97%|█████████▋| 651/670 [03:38<00:01, 13.24it/s] 97%|█████████▋| 653/670 [03:38<00:01, 14.23it/s] 98%|█████████▊| 655/670 [03:38<00:01, 14.45it/s] 98%|█████████▊| 657/670 [03:39<00:00, 14.35it/s] 98%|█████████▊| 659/670 [03:39<00:00, 14.10it/s] 99%|█████████▊| 661/670 [03:39<00:00, 14.63it/s] 99%|█████████▉| 663/670 [03:39<00:00, 14.71it/s] 99%|█████████▉| 665/670 [03:39<00:00, 14.71it/s]100%|█████████▉| 667/670 [03:39<00:00, 14.73it/s]100%|█████████▉| 669/670 [03:39<00:00, 15.98it/s]Saving model checkpoint to /u6/cjrisi/nocturnal/models/ttm/kaggle_brisT1D/2025-10-05_19-33-54/5min_patients/output/checkpoint-670
Configuration saved in /u6/cjrisi/nocturnal/models/ttm/kaggle_brisT1D/2025-10-05_19-33-54/5min_patients/output/checkpoint-670/config.json
Model weights saved in /u6/cjrisi/nocturnal/models/ttm/kaggle_brisT1D/2025-10-05_19-33-54/5min_patients/output/checkpoint-670/model.safetensors


Training completed. Do not forget to share your model on huggingface.co/models =)


                                                 100%|██████████| 670/670 [03:41<00:00, 15.98it/s]
============================================================
TRAINING COMPLETED SUCCESSFULLY
Final train loss: 0.8224595488897011
Final eval loss: None
Best eval loss: inf
Best checkpoint: None
Training samples/second: 6169.58
============================================================
{'train_runtime': 221.0199, 'train_samples_per_second': 6169.58, 'train_steps_per_second': 3.031, 'train_loss': 0.8224595488897011, 'epoch': 10.0, 'timestamp': 1759693056.9654326, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
[TrackingCallback] Mean Epoch Time = 22.101757621765138 seconds, Total Train Time = 221.02009558677673

============================================================
TRAINING COMPLETED SUCCESSFULLY
Final train loss: 0.8224595488897011
Final eval loss: None
Best eval loss: inf
Best checkpoint: None
Training samples/second: 6169.58
============================================================
100%|██████████| 670/670 [03:41<00:00,  3.03it/s]
INFO: [enhanced_info_print] [main] -------------------- Evaluating... --------------------

INFO: [enhanced_info_print] [main] ++++++++++++++++++++ Test MSE after few-shot 100% fine-tuning ++++++++++++++++++++

***** Running Evaluation *****
  Num examples = 14984
  Batch size = 2048
  0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:00<00:00, 15.04it/s] 50%|█████     | 4/8 [00:00<00:00, 13.99it/s] 75%|███████▌  | 6/8 [00:00<00:00, 15.76it/s]100%|██████████| 8/8 [00:01<00:00,  4.23it/s]100%|██████████| 8/8 [00:01<00:00,  4.36it/s]
INFO: [main] Training metrics saved to: /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927/training_metrics.json
{'eval_loss': 0.8198937773704529, 'eval_custom_error': 'Cannot extract labels from complex structure', 'eval_runtime': 17.6577, 'eval_samples_per_second': 848.584, 'eval_steps_per_second': 0.453, 'epoch': 10.0, 'timestamp': 1759693074.6247745, 'custom_batch_size': 2048, 'custom_learning_rate': 0.002}
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
METRICS_JSON:{"final_train_loss": 0.8224595488897011, "final_eval_loss": 0.8198937773704529, "best_eval_loss": 0.8198937773704529, "best_checkpoint": "checkpoint-670", "training_samples_per_second": 6169.58}
Training finished at: 2025-10-05 19:37:56 UTC
Training exit code: 0
Total elapsed time: 0h 4m 17s (257 seconds)
Run completed. Logs and monitoring data saved to: /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927
Updating model registry with completion info...
Warning: Could not load metrics: name 'os' is not defined
Successfully loaded metrics from /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927/training_metrics.json
Updated registry for run: run_20251005_193339_job1354927 with status: completed
All run data and logs saved to: /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927
Configuration and results tracked in model registry
Moving SLURM output files to run directory...
Moved SLURM output file to /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927/
Moved SLURM error file to /u6/cjrisi/nocturnal/results/runs/ttm_finetune/run_20251005_193339_job1354927/
